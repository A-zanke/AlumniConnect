<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WhatsApp-Style Chat (Dark)</title>
  <style>
    :root {
      --bg: #0b0b0b;
      --text: #e5e7eb;
      --text-dim: #9aa0a6;
      --sent-grad-a: #3b82f6; /* blue-500 */
      --sent-grad-b: #6366f1; /* indigo-500 */
      --rcv-bg: rgba(255,255,255,0.06);
      --rcv-border: rgba(255,255,255,0.12);
      --pill-bg: rgba(255,255,255,0.08);
      --accent: #22c55e; /* green-500 */
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font: 500 14.5px/1.55 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow: hidden;
    }

    .chat-wrap { height: 100vh; display: grid; grid-template-rows: 1fr; }

    .chat {
      overflow-y: auto;
      padding: 20px 16px 28px;
      scroll-behavior: smooth;
    }

    /* Smooth dark scrollbar */
    .chat::-webkit-scrollbar { width: 10px; }
    .chat::-webkit-scrollbar-track { background: #101010; }
    .chat::-webkit-scrollbar-thumb { background: #2a2a2a; border-radius: 8px; }
    .chat::-webkit-scrollbar-thumb:hover { background: #3a3a3a; }
    /* Firefox */
    .chat { scrollbar-width: thin; scrollbar-color: #2a2a2a #101010; }

    .row { display: flex; margin: 6px 0; gap: 8px; align-items: flex-end; }
    .row.sent { justify-content: flex-end; }
    .row.received { justify-content: flex-start; }

    .bubble {
      max-width: min(75vw, 720px);
      padding: 10px 12px;
      border-radius: 16px;
      word-wrap: break-word;
      word-break: break-word;
      white-space: pre-wrap;
      transform: translateY(0);
      transition: transform 160ms cubic-bezier(.2,.7,.3,1), box-shadow 160ms cubic-bezier(.2,.7,.3,1), opacity 160ms;
    }
    .row.sent .bubble {
      background: linear-gradient(140deg, var(--sent-grad-a), var(--sent-grad-b));
      color: #fff;
      box-shadow: 0 6px 22px rgba(59,130,246,0.18);
      border-top-right-radius: 18px; /* outer corner slightly larger */
    }
    .row.received .bubble {
      background: var(--rcv-bg);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--rcv-border);
      color: #e8eaed;
      box-shadow: 0 8px 26px rgba(0,0,0,0.22);
      border-top-left-radius: 18px;
    }
    .row:hover .bubble { transform: translateY(-1px); }

    .time {
      margin-top: 6px;
      font-size: 11px;
      line-height: 1;
      color: var(--text-dim);
      text-align: right;
      user-select: none;
    }
    .row.received .time { text-align: left; }

    /* Emoji-only messages: bigger, no bubble */
    .row.emoji-only .bubble {
      background: transparent !important;
      border: 0 !important;
      box-shadow: none !important;
      padding: 0 !important;
      font-size: 2.1rem; /* tasteful large */
      line-height: 1.1;
    }

    /* Inline emoji treatment */
    .emoji-char {
      display: inline-block;
      font-variant-emoji: emoji;
      transform-origin: center;
      font-size: 1.35em; /* emojis slightly larger than text */
      line-height: 1;
      transition: transform 140ms cubic-bezier(.2,.7,.3,1);
    }
    .emoji-char:hover { transform: scale(1.1); }

    /* Reaction button shown on hover */
    .react-btn {
      opacity: 0;
      position: relative;
      z-index: 2;
      width: 28px; height: 28px;
      min-width: 28px;
      border-radius: 9999px;
      display: grid; place-items: center;
      cursor: pointer;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.12);
      color: #e8eaed;
      transition: opacity 150ms cubic-bezier(.2,.7,.3,1), transform 150ms cubic-bezier(.2,.7,.3,1), background 150ms;
    }
    .react-btn:hover { background: rgba(255,255,255,0.14); }

    .row.sent .react-btn { margin-left: 8px; }
    .row.received .react-btn { margin-right: 8px; }

    .row:hover .react-btn,
    .react-btn:focus-visible { opacity: 1; }

    /* Day separator */
    .day-sep {
      display: flex; justify-content: center; margin: 14px 0; user-select: none;
    }
    .day-sep span {
      font-size: 12px; color: #c9cdd1;
      background: var(--pill-bg);
      border: 1px solid rgba(255,255,255,0.08);
      padding: 6px 10px; border-radius: 9999px;
      letter-spacing: .02em;
    }

    /* Container widths */
    .row-inner { display: flex; align-items: flex-end; gap: 8px; max-width: 100%; }

    /* Prevent horizontal scroll */
    .chat { overflow-x: hidden; }
  </style>
</head>
<body>
  <div class="chat-wrap">
    <div id="chat" class="chat" aria-label="Chat messages" role="list">
      <!-- Messages will be rendered by JS -->
    </div>
  </div>

  <script>
    // --- Utilities ---
    const EMOJI_REGEX = /\p{Extended_Pictographic}/u; // modern emoji class
    function wrapEmoji(text) {
      const out = [];
      for (let i = 0; i < text.length; i++) {
        const ch = text[i];
        if (EMOJI_REGEX.test(ch)) {
          out.push(`<span class="emoji-char" aria-hidden="false">${ch}</span>`);
        } else {
          out.push(ch);
        }
      }
      return out.join("");
    }

    function isEmojiOnly(text) {
      const stripped = text.trim();
      if (!stripped) return false;
      // If every char is emoji or whitespace
      for (let i = 0; i < stripped.length; i++) {
        const ch = stripped[i];
        if (!EMOJI_REGEX.test(ch)) return false;
      }
      return true;
    }

    function pad2(n){ return n < 10 ? '0' + n : '' + n; }
    function fmtTime(date){ return `${pad2(date.getHours())}:${pad2(date.getMinutes())}`; }

    function dayLabelFor(date){
      const today = new Date(); today.setHours(0,0,0,0);
      const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());
      const diffDays = Math.round((today - d) / 86400000);
      if (diffDays === 0) return 'Today';
      if (diffDays === 1) return 'Yesterday';
      return date.toLocaleDateString(undefined, { day: '2-digit', month: 'short', year: 'numeric' });
    }

    // --- Sample messages (Yesterday + Today) ---
    const now = new Date();
    const yesterday = new Date(now.getTime() - 86400000);

    const messages = [
      { id: 'm1', text: 'Hey! ðŸ‘‹', sent: false, ts: new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate(), 18, 40).toISOString() },
      { id: 'm2', text: 'ðŸ˜„ðŸŽ‰', sent: false, ts: new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate(), 18, 41).toISOString() },
      { id: 'm3', text: 'Hello! This looks amazing already.', sent: true, ts: new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate(), 18, 42).toISOString() },

      { id: 'm4', text: 'Working on the dark UI redesign now.', sent: false, ts: new Date(now.getFullYear(), now.getMonth(), now.getDate(), 9, 2).toISOString() },
      { id: 'm5', text: 'Perfect â€” subtle gradients and frosted glass, right?', sent: true, ts: new Date(now.getFullYear(), now.getMonth(), now.getDate(), 9, 3).toISOString() },
      { id: 'm6', text: 'Exactly. Also hover micro-interactions âœ¨', sent: false, ts: new Date(now.getFullYear(), now.getMonth(), now.getDate(), 9, 4).toISOString() },
      { id: 'm7', text: 'ðŸ‘', sent: true, ts: new Date(now.getFullYear(), now.getMonth(), now.getDate(), 9, 5).toISOString() },
    ];

    // --- Render ---
    const chatEl = document.getElementById('chat');

    function render() {
      chatEl.innerHTML = '';
      let lastDay = '';
      messages
        .slice()
        .sort((a, b) => new Date(a.ts) - new Date(b.ts))
        .forEach((msg) => {
          const d = new Date(msg.ts);
          const label = dayLabelFor(d);
          if (label !== lastDay) {
            const sep = document.createElement('div');
            sep.className = 'day-sep';
            sep.innerHTML = `<span>${label}</span>`;
            chatEl.appendChild(sep);
            lastDay = label;
          }

          const row = document.createElement('div');
          const emojiOnly = isEmojiOnly(msg.text);
          row.className = `row ${msg.sent ? 'sent' : 'received'}${emojiOnly ? ' emoji-only' : ''}`;
          row.setAttribute('role', 'listitem');

          const inner = document.createElement('div');
          inner.className = 'row-inner';

          // For received, reaction button goes before bubble; for sent, after
          if (!msg.sent) inner.appendChild(makeReactButton(msg.id));

          const bubble = document.createElement('div');
          bubble.className = 'bubble';
          const safe = document.createElement('div');
          safe.className = 'txt';
          safe.innerHTML = wrapEmoji(msg.text);
          bubble.appendChild(safe);

          // Timestamp
          const time = document.createElement('div');
          time.className = 'time';
          time.textContent = fmtTime(d);
          bubble.appendChild(time);

          inner.appendChild(bubble);
          if (msg.sent) inner.appendChild(makeReactButton(msg.id));

          row.appendChild(inner);
          chatEl.appendChild(row);
        });

      // Scroll to bottom
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    function makeReactButton(id) {
      const btn = document.createElement('button');
      btn.className = 'react-btn';
      btn.type = 'button';
      btn.title = 'React';
      btn.setAttribute('aria-label', 'Add reaction');
      btn.textContent = 'ðŸ˜Š';
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        console.log('reaction clicked', { messageId: id });
      });
      return btn;
    }

    render();
  </script>
</body>
</html>
